<h2>Widget</h2>
<p>
    Query the database for unique visitors to each of the avaliable posts. A vist is recorded when a viewer <br>loads the url to a post, the recorded data includes the pupblic IP address of the user and timestamp of the sesion.
    <br>Known issues; Returned timestamp may not match 1:1 with the search query, this may be due to GMT vs Local time.
</p>
<p>Test data is auto generated by the backend from January to July 2020</p>
<div class="design">
    <div class="design-section">
        Post
        <select [(ngModel)]="selectedPost">
        <option *ngFor="let post of posts" [value]="post.id">
            {{post.title}}
        </option>
        </select>
    </div>
    <div class="design-section">
        <ngb-datepicker (dateSelect)="onDateSelection($event)" [dayTemplate]="ts" outsideDays="hidden" #d></ngb-datepicker>
        <ng-template #ts let-date let-focused="focused">
            <span class="custom-day"
                  [class.focused]="focused"
                  [class.range]="isRange(date)"
                  [class.faded]="isHovered(date) || isInside(date)"
                  (mouseenter)="hoveredDate = date"
                  (mouseleave)="hoveredDate = null">
              {{ date.day }}
            </span>
          </ng-template>
    </div>
    <div class="design-section">
        From Time <ngb-timepicker [(ngModel)]="fromtime" [seconds]="true"></ngb-timepicker>
    </div>
    <div class="design-section">
        To Time <ngb-timepicker [(ngModel)]="totime" [seconds]="true"></ngb-timepicker>
    </div>
    <div class="design-section">
        <button class="btn btn-primary" (click)="search()">Search</button>
    </div>
    <div class="design-section">
        <div class="alert alert-danger" role="alert" *ngIf="error">
            {{error}}
        </div>
    </div>
</div>

<table class="table">
    <thead>
        <tr>
            <th scope="col">IP Address</th>
            <th scope="col">Created Date</th>
            <th *ngIf="history" scope="col">{{history.length}}</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let history of history">
            <td>{{history.ipAddress}}</td>
            <td>{{history.created}}</td>
        </tr>
    </tbody>
</table>